#!/bin/bash

while [ $(/sbin/ifconfig wwan0|grep inet|wc -l) -eq 0 ] && [ $(ps -A|grep rewwan0|wc -l) -le 2 ]
do
  timeout 15 qmi-network /dev/cdc-wdm0 stop
  timeout 15 qmi-network /dev/cdc-wdm0 start
  timeout 30 /sbin/udhcpc -i wwan0
done

while [ "$(qmi-network /dev/cdc-wdm0 status|grep Status|awk '{print $2}')" = "disconnected" ]
do
  timeout 15 qmi-network /dev/cdc-wdm0 stop
  timeout 15 qmi-network /dev/cdc-wdm0 start
done
